version: 2
jobs:
  build:
    docker:
      - image: circleci/python:3.7-node
    working_directory: ~/repo
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: Install nvm
          command: |
            curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.36.0/install.sh | bash
            echo 'export NVM_DIR=$HOME/.nvm' >> $BASH_ENV
            echo 'source $NVM_DIR/nvm.sh' >> $BASH_ENV
      - run:
          name: Set node to version required by application for future circleci steps
          command: |
            nvm install
            NODE_VERSION=$(node -v)
            nvm alias default ${NODE_VERSION//v}
      - run:
          name: node version
          command: |
            node -v